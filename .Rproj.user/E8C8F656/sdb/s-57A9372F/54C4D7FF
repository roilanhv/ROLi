{
    "collab_server" : "",
    "contents" : "# longwaveR, a downward longwave radiation estimation R package.\nRoilan Hernández Valdés  \nOctober 9, 2016  \n\n[![DOI](https://zenodo.org/badge/67534590.svg)](https://zenodo.org/badge/latestdoi/67534590)\n\n# Introduction\n\nThe incident longwave radiation (*Li*) is one of the essential components in the surface energy balance. It influences the balance of radiation, which determines the energy available to sensible and latent heat fluxes in surface. The *Li* can be determined with good accuracy from the moisture vertical profile, air temperature and other gases ($CO_2$, $CH_4$, $N_2O$) concentration in the atmosphere. But these data are not always available and therefore simpler methods have been developed based on more readily available measures, such as the temperature and humidity measured in meteorological stations. Several empirical expressions to estimate the emissivity of the atmosphere in clear sky conditions ($\\epsilon_{ac}$) and cloud cover fraction ($C$) are available in the literature. However, when applied to regions different from those in which they were obtained, the uncertainty in the estimation increases.\n\n\n\n\n\n\n\n# Transforming data\n\n\n```r\n    data_atmos <- \n    read_rds(\"../../BAGS/longwaveR_data.rds\") %>%\n    # Adding Potential Radiation in site (W/m2):\n    mutate(Rpot = PotRad(date,lon=-53.76,lat=-29.72 )) %>%\n    # Adding partial vapor water pressure (Pa):\n    mutate(es = (rh/100) * (0.6112 * exp((17.67*Ta)/(243.5+Ta))) *10) %>%\n    # Converting air temperature from C to K\n    mutate(Ta = Ta+273.15) %>%\n    # Ussing kloudines function to calculate the attenuation \n    # gobal radiation index \n    mutate(K = kloudines(Rg = Rg,dates = date,lon=-53.76,lat=-29.72 ))\n\n    head(data_atmos) \n```\n\n```\n## Source: local data frame [6 x 8]\n## \n##                  date       Rg       Ta       rh    Li     Rpot       es\n##                (time)    (dbl)    (dbl)    (dbl) (dbl)    (dbl)    (dbl)\n## 1 2013-11-20 00:00:00  0.00000 293.7669 93.08896    NA   0.0000 22.60014\n## 2 2013-11-20 01:00:00  0.00000 293.5870 92.83499    NA   0.0000 22.28957\n## 3 2013-11-20 02:00:00  0.00000 293.2014 93.85086    NA   0.0000 22.00245\n## 4 2013-11-20 03:00:00  0.00000 293.1757 94.61277    NA   0.0000 22.14578\n## 5 2013-11-20 04:00:00  0.00000 293.0729 94.61277    NA   0.0000 22.00510\n## 6 2013-11-20 05:00:00 23.76502 293.1757 94.61277    NA 127.6601 22.14578\n## Variables not shown: K (dbl)\n```\n\n# Getting a *Li* estimation\n\n\n```r\n    # Li calculated by FAN emissivity combined with CQB cloud cover scheme\n    Li_sim <- get.Li(data = data_atmos, E_fun = \"FAN\", C_fun = \"CQB\") \n    # Observed and calculated Li:\n    Li_sim_obs <- cbind(data_atmos %>% select(date,Li), Li_sim)\n    head(Li_sim_obs[complete.cases(Li_sim_obs),])#%>% kable()\n```\n\n```\n##                   date       Li  FAN_CQB\n## 14 2013-11-20 13:00:00 435.6298 438.2344\n## 15 2013-11-20 14:00:00 436.8293 441.3524\n## 16 2013-11-20 15:00:00 433.7094 442.8125\n## 17 2013-11-20 16:00:00 432.1021 438.6050\n## 18 2013-11-20 17:00:00 431.7994 428.7865\n## 19 2013-11-20 18:00:00 431.1240 400.2193\n```\n\n## Determining error\n\n### Hourly data\n\n\n\n```r\n    scatterPlot(mydata = Li_sim_obs,\n                x = \"Li\", y = \"FAN_CQB\",\n                linear = TRUE,mod.line = TRUE,\n                pch = 8, col = \"red\",\n                type = \"season\", hemisphere = \"southern\"\n                )\n```\n\n<img src=\"README_files/figure-html/unnamed-chunk-4-1.png\" style=\"display: block; margin: auto;\" />\n\n\n```r\n    timePlot(mydata = Li_sim_obs,\n             pollutant = c(\"Li\",\"FAN_CQB\"), \n             group = TRUE, \n             lty = 1, lwd = 1, \n             col = 1:2)\n```\n\n<img src=\"README_files/figure-html/unnamed-chunk-5-1.png\" style=\"display: block; margin: auto;\" />\n\n\n```r\n    # Function for statistical analysis\n    #   CalcStats\n    CalcStats(data_li = Li_sim_obs,\n          statistic = c(\"rmse\",\"pbias\",\"NSE\",\"nrmse\",\"rSD\"),\n          avg.time = \"hourly\") #%>% kable( )\n```\n\n```\n## Source: local data frame [1 x 6]\n## \n##   schemes     rmse pbias       NSE nrmse       rSD\n##    (fctr)    (dbl) (dbl)     (dbl) (dbl)     (dbl)\n## 1 FAN_CQB 30.72946   4.8 0.3329657  81.7 0.9349243\n```\n\n### Mean daily data\n\n\n```r\n    scatterPlot(mydata = Li_sim_obs,\n                x = \"Li\", y = \"FAN_CQB\",\n                linear = TRUE,mod.line = TRUE,\n                pch = 8, col = \"red\",\n                type = \"season\", hemisphere = \"southern\",\n                avg.time = \"day\"\n                )\n```\n\n<img src=\"README_files/figure-html/unnamed-chunk-7-1.png\" style=\"display: block; margin: auto;\" />\n\n\n\n```r\n    timePlot(mydata = Li_sim_obs,\n             pollutant = c(\"Li\",\"FAN_CQB\"), \n             group = TRUE, \n             lty = 1, lwd = 1.5, \n             col = 1:2,\n             avg.time = \"day\")\n```\n\n<img src=\"README_files/figure-html/unnamed-chunk-8-1.png\" style=\"display: block; margin: auto;\" />\n\n\n```r\nCalcStats(data_li = Li_sim_obs,\n          statistic = c(\"rmse\",\"pbias\",\"NSE\",\"nrmse\",\"rSD\"),\n          avg.time = \"daily\") \n```\n\n```\n## Source: local data frame [1 x 6]\n## \n##   schemes     rmse pbias       NSE nrmse       rSD\n##    (fctr)    (dbl) (dbl)     (dbl) (dbl)     (dbl)\n## 1 FAN_CQB 20.80353   4.8 0.5759504  65.1 0.9579928\n```\n\n# Adjusting *Li* schemes coeficients\n\n\n```r\n    # Li calculated by FAN emissivity combined with CQB cloud cover scheme\n    # ADJUSTING mode\n    Li_sim_adj <- get.Li(data = data_atmos, E_fun = \"FAN\", C_fun = \"CQB\",\n                         adjust = TRUE)\n    names(Li_sim_adj) <- paste0(names(Li_sim_adj),\"_adj\")\n    # Observed and calculated Li:\n    Li_sim_obs_adj <- cbind(data_atmos %>% select(date,Li), Li_sim,Li_sim_adj)\n    head(Li_sim_obs_adj[complete.cases(Li_sim_obs_adj),]) #%>% kable()\n```\n\n```\n##                   date       Li  FAN_CQB FAN_CQB_adj\n## 14 2013-11-20 13:00:00 435.6298 438.2344    423.5483\n## 15 2013-11-20 14:00:00 436.8293 441.3524    422.7837\n## 16 2013-11-20 15:00:00 433.7094 442.8125    415.9146\n## 17 2013-11-20 16:00:00 432.1021 438.6050    412.5802\n## 18 2013-11-20 17:00:00 431.7994 428.7865    408.7269\n## 19 2013-11-20 18:00:00 431.1240 400.2193    405.8758\n```\n\n\n\n```r\n    scatterPlot(mydata = Li_sim_obs_adj,\n                x = \"Li\", y = \"FAN_CQB_adj\",\n                linear = TRUE,mod.line = TRUE,\n                pch = 8, col = \"red\",\n                type = \"season\", hemisphere = \"southern\"\n                )\n```\n\n<img src=\"README_files/figure-html/unnamed-chunk-11-1.png\" style=\"display: block; margin: auto;\" />\n\n\n\n```r\n    timePlot(mydata = Li_sim_obs_adj,\n             pollutant = c(\"Li\",\"FAN_CQB\",\"FAN_CQB_adj\"), \n             group = TRUE, \n             lty = 1, lwd = 1, \n             col = 1:3, avg.time = \"day\")\n```\n\n<img src=\"README_files/figure-html/unnamed-chunk-12-1.png\" style=\"display: block; margin: auto;\" />\n\n\n```r\nCalcStats(data_li = Li_sim_obs_adj,\n          statistic = c(\"rmse\",\"pbias\",\"NSE\",\"nrmse\",\"rSD\"),\n          avg.time = \"hourly\") \n```\n\n```\n## Source: local data frame [2 x 6]\n## \n##       schemes     rmse pbias       NSE nrmse       rSD\n##        (fctr)    (dbl) (dbl)     (dbl) (dbl)     (dbl)\n## 1     FAN_CQB 30.72946   4.8 0.3329657  81.7 0.9349243\n## 2 FAN_CQB_adj 26.07404   1.5 0.5197638  69.3 1.0294446\n```\n\n```r\nCalcStats(data_li = Li_sim_obs_adj,\n          statistic = c(\"rmse\",\"pbias\",\"NSE\",\"nrmse\",\"rSD\"),\n          avg.time = \"daily\") \n```\n\n```\n## Source: local data frame [2 x 6]\n## \n##       schemes     rmse pbias       NSE nrmse       rSD\n##        (fctr)    (dbl) (dbl)     (dbl) (dbl)     (dbl)\n## 1     FAN_CQB 20.80353   4.8 0.5759504  65.1 0.9579928\n## 2 FAN_CQB_adj 17.66632   1.4 0.6942018  55.3 1.0016697\n```\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
    "created" : 1486036227106.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1333815243",
    "id" : "54C4D7FF",
    "lastKnownWriteTime" : 1476316082,
    "last_content_update" : 1476316082,
    "path" : "~/A_DOUTORADO/CODE_WORK/OnGitHub_ROLi/ROLi/README.md",
    "project_path" : "README.md",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "markdown"
}